# VAUBAN - Default configuration
# This file contains the default values for all environments.
# Environment-specific files (development.toml, production.toml, etc.)
# can override these values.
#
# Configuration is shared by all VAUBAN components:
# - vauban-supervisor: Service orchestrator
# - vauban-web: Web interface and API

# ==============================================================================
# SUPERVISOR CONFIGURATION
# ==============================================================================

[supervisor]
# Environment: "development" or "production"
environment = "development"
# Path to service binaries (relative to workspace root or absolute)
bin_path = "./target/debug"
# Log level: "trace", "debug", "info", "warn", "error"
log_level = "debug"

# Watchdog configuration
[supervisor.watchdog]
heartbeat_interval_secs = 5
heartbeat_timeout_secs = 2
max_missed_heartbeats = 3
max_respawns_per_hour = 10
drain_timeout_secs = 30

# Default credentials for services
# When uid/gid are 0, the current user is used (development mode).
[defaults]
uid = 0
gid = 0

# Service configurations
# Each service can override uid/gid from [defaults].

[services.audit]
name = "vauban-audit"
binary = "vauban-audit"

[services.vault]
name = "vauban-vault"
binary = "vauban-vault"

[services.rbac]
name = "vauban-rbac"
binary = "vauban-rbac"

[services.auth]
name = "vauban-auth"
binary = "vauban-auth"

[services.proxy_ssh]
name = "vauban-proxy-ssh"
binary = "vauban-proxy-ssh"

[services.proxy_rdp]
name = "vauban-proxy-rdp"
binary = "vauban-proxy-rdp"

[services.web]
name = "vauban-web"
binary = "vauban-web"

# ==============================================================================
# WEB CONFIGURATION (vauban-web)
# ==============================================================================

[server]
host = "0.0.0.0"
port = 8443
# workers = 4  # Optional, left to Tokio by default

# TLS configuration (required - HTTPS only, TLS 1.3)
# Development: certificates are in vauban-web/certs/ (relative to workspace root)
# Production: certificates are in /usr/local/etc/vauban/certs/
[server.tls]
cert_path = "vauban-web/certs/server.crt"
key_path = "vauban-web/certs/server.key"
# ca_chain_path = "vauban-web/certs/ca-chain.crt"  # Optional, for intermediate certificates

[database]
url = "postgresql://vauban:vauban@localhost/vauban"
max_connections = 10
min_connections = 2
connect_timeout_secs = 10

[cache]
enabled = false
url = "redis://localhost:6379"
default_ttl_secs = 3600

[jwt]
access_token_lifetime_minutes = 15
refresh_token_lifetime_days = 1
algorithm = "HS256"

[security]
password_min_length = 12
max_failed_login_attempts = 5
session_max_duration_secs = 28800   # 8 hours
session_idle_timeout_secs = 1800    # 30 minutes
rate_limit_per_minute = 10

[security.argon2]
memory_size_kb = 65536
iterations = 3
parallelism = 1

[logging]
level = "info"
format = "text"

[api]
# Enable or disable the M2M API endpoints (/api/v1/*)
# When disabled, only web routes are available
enabled = true
# API route prefix
prefix = "/api/v1"
