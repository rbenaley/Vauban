{% extends "base.html" %}

{% block title %}{{ title }} - {{ vauban.brand_name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/css/xterm.min.css">
<style>
    /* Terminal container styling */
    #terminal-container {
        width: 100%;
        height: calc(100vh - 200px);
        min-height: 400px;
        background: #1e1e1e;
        border-radius: 0.5rem;
        padding: 0.5rem;
    }

    /* Fullscreen mode - occupy entire screen */
    #terminal-container:fullscreen {
        height: 100vh;
        width: 100vw;
        border-radius: 0;
        padding: 0;
    }

    #terminal {
        width: 100%;
        height: 100%;
    }

    /* Force xterm.js elements to fill container */
    #terminal .xterm {
        height: 100%;
    }

    #terminal .xterm-viewport {
        height: 100% !important;
    }

    #terminal .xterm-screen {
        height: 100%;
    }

    /* Status bar styling */
    .terminal-status {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.5rem 1rem;
        background: #2d2d2d;
        border-radius: 0.5rem 0.5rem 0 0;
        color: #ccc;
        font-size: 0.875rem;
    }

    .status-indicator {
        width: 0.5rem;
        height: 0.5rem;
        border-radius: 50%;
    }

    .status-indicator.connecting {
        background: #f59e0b;
        animation: pulse 1s infinite;
    }

    .status-indicator.connected {
        background: #10b981;
    }

    .status-indicator.disconnected {
        background: #ef4444;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    /* Hide scrollbars in terminal for cleaner look */
    .xterm-viewport::-webkit-scrollbar {
        width: 8px;
    }

    .xterm-viewport::-webkit-scrollbar-track {
        background: #1e1e1e;
    }

    .xterm-viewport::-webkit-scrollbar-thumb {
        background: #4b5563;
        border-radius: 4px;
    }
</style>
{% endblock %}

{% block content %}
<div class="space-y-4" x-data="sshTerminal('{{ session_id }}')">
    <!-- Terminal header -->
    <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
            <a href="/assets" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                </svg>
            </a>
            <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">{{ title }}</h1>
        </div>
        <div class="flex items-center gap-2">
            <button @click="toggleFullscreen()" class="px-3 py-1.5 text-sm bg-gray-600 hover:bg-gray-700 text-white rounded-md">
                Fullscreen
            </button>
            <button @click="disconnect()" class="px-3 py-1.5 text-sm bg-red-600 hover:bg-red-700 text-white rounded-md">
                Disconnect
            </button>
        </div>
    </div>

    <!-- Terminal status bar -->
    <div class="terminal-status">
        <span class="status-indicator" :class="status"></span>
        <span x-text="statusText"></span>
        <span class="ml-auto text-gray-500">Session: {{ session_id|truncate(8) }}</span>
    </div>

    <!-- Terminal container -->
    <div id="terminal-container" x-ref="container">
        <div id="terminal" x-ref="terminal"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- xterm.js and addons - loaded before Alpine initializes the component -->
<script src="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/lib/xterm.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@xterm/addon-fit@0.10.0/lib/addon-fit.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@xterm/addon-web-links@0.11.0/lib/addon-web-links.min.js"></script>
{% endblock %}
